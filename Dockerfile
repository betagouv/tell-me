FROM node:16-alpine

# Mandatory arguments
ARG DATABASE_URL
ARG EDDSA_PRIVATE_KEY
ARG NEXT_PUBLIC_EDDSA_PUBLIC_KEY

EXPOSE 3000

WORKDIR /app

COPY . .

RUN yarn

ENV DATABASE_URL=$DATABASE_URL
ENV NEXT_PUBLIC_NODE_ENV=production
ENV NODE_ENV=production

RUN yarn build

ENV EDDSA_PRIVATE_KEY=$EDDSA_PRIVATE_KEY
ENV NEXT_PUBLIC_EDDSA_PUBLIC_KEY=$NEXT_PUBLIC_EDDSA_PUBLIC_KEY

ENTRYPOINT [ "yarn", "start" ]
